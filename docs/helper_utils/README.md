# 目录统计工具 (Dir Stats)

## 功能介绍

Dir Stats 是一个实用的目录结构统计工具，用于分析指定目录的文件和目录结构，提供详细的文件类型分布信息。该工具特别适用于快速了解项目结构、分析文件组成以及进行项目审计。

主要特性包括：

- 统计目录下的总文件数和总目录数
- 分析文件类型分布情况（包括数量和百分比）
- 提供一级和二级目录的详细统计信息
- 智能处理中文字符显示，确保表格对齐美观
- 支持自定义根目录路径
- 友好的命令行界面和清晰的结果展示

## 使用方法

### 基本用法

最简单的使用方式是直接运行脚本，默认会统计项目根目录：

```bash
python src/helper_utils/dir_stats.py
```

### 指定目录路径

通过 `--root_dir` 参数指定要分析的目录：

```bash
python src/helper_utils/dir_stats.py --root_dir path/to/your/directory
```

### 查看帮助信息

```bash
python src/helper_utils/dir_stats.py --help
```

## 输出说明

运行脚本后，将以表格形式输出以下信息：

1. **总览信息**
   - 总文件数
   - 总目录数（包含一级目录和二级目录数量）

2. **整体文件类型分布**
   - 按文件数量降序排列的各类文件统计（包含文件扩展名和数量）

3. **一级目录详细信息**
   - 目录名：目录的名称
   - 本级文件数：目录下直接包含的文件数量
   - 二级目录数：目录下包含的子目录数量
   - 总文件数：目录及其所有子目录中包含的文件总数
   - 文件类型分布：该目录下各类文件的数量统计

4. **二级目录详细信息**
   - 父目录/目录名：目录的完整路径（相对根目录）
   - 文件数：该二级目录下的文件数量
   - 文件类型分布及百分比：该目录下各类文件的数量和占比

## 核心功能模块

### 目录遍历模块 (`traverse_directory`)

负责递归遍历指定目录，收集文件和目录信息，统计各类文件数量。该函数处理了多种异常情况，包括目录不存在、权限错误等，确保工具的稳定性。

### 文本格式化模块

包含一系列用于美化输出的函数：

- `format_file_types`: 格式化文件类型统计信息，支持按数量降序排列
- `calculate_width`: 计算文本的显示宽度，特别处理了中文字符
- `format_column`: 根据显示宽度格式化文本，确保表格对齐

### 结果展示模块 (`print_statistics`)

以清晰易读的表格形式打印统计结果，确保中文字符和英文数据对齐，提供良好的视觉体验。

## 最佳实践

1. **项目结构分析**
   - 使用该工具快速了解新项目的文件结构和组成
   - 分析代码库中不同类型文件的分布情况

2. **项目审计**
   - 定期运行该工具，监控项目文件结构的变化
   - 识别项目中可能的文件类型不平衡或异常增长

3. **性能优化**
   - 对于大型项目，可以先使用该工具了解整体结构，再深入分析具体部分
   - 通过文件类型分布，识别可能需要特别关注的文件类型

4. **与其他工具结合**
   - 可以将该工具的输出与其他分析工具结合使用，获取更全面的项目信息
   - 可以通过脚本重定向输出到文件，保存统计结果供后续分析

## 注意事项

1. 对于非常大的目录结构，遍历可能需要一定时间，请耐心等待
2. 某些系统目录可能需要管理员权限才能访问，工具会自动处理权限错误并显示警告信息
3. 文件类型统计基于文件扩展名，不考虑文件内容的实际类型
4. 为了确保表格显示美观，输出结果在窄屏终端可能会出现换行

## 示例输出

```
================================================================================
目录统计结果: /data/home/project/d2l_note
================================================================================
总文件数: 156
总目录数: 28 (一级目录: 8, 二级目录: 19)

整体文件类型分布:
  py: 98 (62.8%), md: 24 (15.4%), json: 12 (7.7%), txt: 8 (5.1%), png: 6 (3.8%), other: 8 (5.1%)

一级目录详细信息:
  目录名                本级文件数    二级目录数    总文件数    文件类型分布
  ----------------------------------------------------------------------------
  [根目录] d2l_note     12           8           156        py: 6, md: 3, json: 2, txt: 1
  src                  0            5           98         py: 88, md: 6, json: 2, txt: 2
  data                 0            3           24         png: 6, txt: 4, json: 8, md: 6
  docs                 0            4           16         md: 8, py: 4, png: 0, txt: 0
  ...

二级目录详细信息:
  父目录/目录名                     文件数      文件类型分布及百分比
  ----------------------------------------------------------------------------
  src/helper_utils                24          py: 20 (83.3%), md: 2 (8.3%), json: 2 (8.3%)
  src/models                      36          py: 32 (88.9%), md: 4 (11.1%)
  data/datasets                   12          txt: 4 (33.3%), json: 6 (50.0%), png: 2 (16.7%)
  ...

================================================================================
```